<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1-2-3 Boxes ¬∑ SQWease</title>
    <script>
    (function(){
        var s = typeof localStorage !== 'undefined' ? localStorage.getItem('sqwease-theme') : null;
        var theme = (s === 'dark' || s === 'light') ? s : 'light';
        document.documentElement.setAttribute('data-theme', theme);
    })();
    </script>
    <style>
        :root {
            --primary: #ff4757;
            --text: #2f3542;
            --bg: #f1f2f6;
            --card-bg: #ffffff;
            --border: #dfe4ea;
            --secondary-text: #747d8c;
        }
        [data-theme="dark"] {
            --primary: #ff6b81;
            --text: #e4e4e4;
            --bg: #1e272e;
            --card-bg: #2d3436;
            --border: #57606f;
            --secondary-text: #a4b0be;
        }
        * { box-sizing: border-box; }
        a:focus-visible, button:focus-visible, input:focus-visible, .theme-toggle:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 16px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background-color 0.3s, color 0.3s;
        }
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.4rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            z-index: 100;
        }
        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        .theme-toggle .icon-dark { display: none; }
        .theme-toggle .icon-light { display: inline; }
        [data-theme="dark"] .theme-toggle .icon-dark { display: inline; }
        [data-theme="dark"] .theme-toggle .icon-light { display: none; }
        .container {
            width: 100%;
            max-width: 800px;
        }
        .nav {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .nav a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
        }
        .nav a:hover { text-decoration: underline; }
        h1 { color: var(--primary); margin-top: 0; }
        .subtitle { color: var(--secondary-text); margin-bottom: 24px; }
        .info-box {
            background: var(--card-bg);
            border-left: 4px solid var(--primary);
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .info-box h3 {
            margin-top: 0;
            color: var(--primary);
            font-size: 1rem;
        }
        .info-box p {
            margin: 8px 0 0;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--secondary-text);
        }
        .info-box ul {
            margin: 8px 0 0 20px;
            padding: 0;
            font-size: 0.9rem;
            line-height: 1.8;
            color: var(--secondary-text);
        }
        .info-box .toggle-info {
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
            user-select: none;
            margin-left: auto;
        }
        .info-box .toggle-info:hover { text-decoration: underline; }
        .set-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 12px;
        }
        .set-tab {
            padding: 10px 16px;
            min-height: 44px;
            border: 2px solid var(--primary);
            background: #fff;
            color: var(--primary);
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
        }
        .set-tab:hover { background: #fff5f5; }
        .set-tab.active { background: var(--primary); color: #fff; }
        .mode-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        .mode-tab {
            padding: 8px 14px;
            border: 1px solid var(--text);
            background: #fff;
            cursor: pointer;
            border-radius: 6px;
        }
        .mode-tab.active { background: var(--primary); color: #fff; border-color: var(--primary); font-weight: bolder; }
        .list-view { max-width: 700px; }
        .box-group {
            margin-bottom: 18px;
        }
        .box-group h3 {
            color: var(--primary);
            margin: 12px 0 8px;
            font-size: 1rem;
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 6px;
        }
        .list-view .box-group:first-child h3 {
            margin-top: 6px;
        }
        .display-phase {
            margin-top: 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .display-phase label {
            color: var(--secondary-text);
            font-weight: 600;
        }
        .select-primary {
            padding: 8px 14px;
            min-height: 44px;
            border: 2px solid var(--primary);
            background: var(--card-bg);
            color: var(--text);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        .select-primary:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        .mode-tabs .select-primary {
            background: var(--card-bg);
        }
        .box-group h3::after {
            content: '‚ñº';
            font-size: 0.7em;
            transition: transform 0.2s;
            display: inline-block;
        }
        .box-group.collapsed h3::after {
            transform: rotate(-90deg);
        }
        .box-group.collapsed .box-item {
            display: none;
        }
        .box-item {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 12px;
            align-items: center;
            padding: 10px 12px;
            background: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .box-item .ja { font-size: 1.1rem; }
        .box-item .romaji { color: var(--secondary-text); font-style: italic; font-size: 0.95rem; }
        .box-item .en { color: var(--text); font-size: 0.95rem; }
        .practice-area {
            max-width: 520px;
            margin: 0 auto;
        }
        .practice-card {
            perspective: 1000px;
            cursor: pointer;
            min-height: 280px;
        }
        .practice-card .card-inner {
            position: relative;
            width: 100%;
            min-height: 280px;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }
        .practice-card.flipped .card-inner { transform: rotateY(180deg); }
        .practice-card .face {
            position: absolute;
            width: 100%;
            min-height: 280px;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.1);
        }
        .practice-card .face-front {
            background: var(--card-bg);
            border: 2px solid var(--primary);
        }
        .practice-card .face-back {
            background: var(--card-bg);
            border: 2px solid #2ed573;
            transform: rotateY(180deg);
        }
        .practice-card .face-front .ja { font-size: 2rem; text-align: center; margin-bottom: 12px; display: block; }
        .practice-card .face-front .romaji { font-size: 1rem; color: var(--secondary-text); font-style: italic; display: block; }
        .practice-card .face-back .ja { font-size: 1.5rem; margin-bottom: 12px; display: block; }
        .practice-card .face-back .romaji { font-size: 1.1rem; color: var(--secondary-text); font-style: italic; margin-bottom: 12px; display: block; }
        .practice-card .face-back .en { font-size: 1.1rem; color: var(--text); display: block; }
        .practice-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-top: 20px;
        }
        .practice-controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: var(--primary);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
        }
        .practice-controls button:hover { opacity: 0.9; }
        .practice-controls button.secondary { background: var(--secondary-text); }
        .progress-text { color: var(--secondary-text); font-size: 0.9rem; }
        .rating-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .rating-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            min-width: 90px;
        }
        .rating-btn:hover { transform: translateY(-2px); }
        .rating-btn .interval { font-size: 0.85rem; opacity: 0.9; }
        .rating-btn.again { background: #ff6b6b; color: white; }
        .rating-btn.again:hover { box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4); }
        .rating-btn.hard { background: #ffa502; color: white; }
        .rating-btn.hard:hover { box-shadow: 0 4px 12px rgba(255, 165, 2, 0.4); }
        .rating-btn.good { background: #2ed573; color: white; }
        .rating-btn.good:hover { box-shadow: 0 4px 12px rgba(46, 213, 115, 0.4); }
        .rating-btn.easy { background: #5352ed; color: white; }
        .rating-btn.easy:hover { box-shadow: 0 4px 12px rgba(83, 82, 237, 0.4); }
        .loading { text-align: center; padding: 40px; color: #747d8c; }
        .error { color: var(--primary); padding: 16px; }
        .hidden { display: none !important; }
        .wordlist-area { max-width: 800px; }
        .wordlist-cats { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px; }
        .wordlist-cat { padding: 8px 12px; border: 1px solid #ddd; background: #fff; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
        .wordlist-cat:hover { background: #f5f5f5; }
        .wordlist-cat.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        .wordlist-table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 16px; }
        .wordlist-table th, .wordlist-table td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #eee; }
        .wordlist-table th { background: var(--border); font-size: 0.85rem; color: var(--secondary-text); }
        .wordlist-table tr:last-child td { border-bottom: none; }
        .wordlist-table .remove-btn { padding: 4px 10px; font-size: 0.8rem; background: #ff6b6b; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        .wordlist-table .remove-btn:hover { background: #ee5a5a; }
        .wordlist-add { display: flex; flex-wrap: wrap; gap: 8px; align-items: flex-end; margin-bottom: 20px; }
        .wordlist-add input { padding: 8px 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 0.95rem; min-width: 100px; background: var(--card-bg); color: var(--text); }
        .wordlist-add label { font-size: 0.8rem; color: var(--secondary-text); display: block; margin-bottom: 2px; }
        .wordlist-add .field { display: flex; flex-direction: column; }
        .wordlist-add button { padding: 8px 16px; background: #2ed573; color: #fff; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; }
        .wordlist-add button:hover { background: #26de81; }
        .wordlist-reset { margin-top: 16px; }
        .wordlist-reset button { padding: 8px 14px; background: var(--secondary-text); color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
        .wordlist-reset button:hover { background: var(--border); }

        @media (max-width: 600px) {
            body { padding: 12px; }
            h1 { font-size: 1.4rem; }
            .subtitle { font-size: 0.9rem; margin-bottom: 16px; }
            .set-tab { padding: 10px 12px; font-size: 0.9rem; }
            .mode-tab { padding: 10px 12px; min-height: 44px; }
            .box-item {
                grid-template-columns: 1fr;
                gap: 4px;
                padding: 12px;
            }
            .box-item .ja { font-size: 1.2rem; }
            .box-item .romaji, .box-item .en { font-size: 0.9rem; }
            .practice-card { min-height: 240px; }
            .practice-card .face { min-height: 240px; padding: 16px; }
            .practice-card .face-front .ja { font-size: 1.5rem; }
            .practice-card .face-front .romaji { font-size: 0.9rem; }
            .practice-card .face-back .ja { font-size: 1.25rem; }
            .practice-card .face-back .romaji { font-size: 0.95rem; }
            .practice-card .face-back .en { font-size: 0.95rem; }
            .practice-controls { flex-wrap: wrap; gap: 10px; }
            .practice-controls button { padding: 12px 18px; min-height: 44px; }
            .rating-buttons { gap: 8px; margin-top: 16px; }
            .rating-btn { min-width: 70px; padding: 10px 14px; font-size: 0.9rem; }
            .wordlist-table th, .wordlist-table td { padding: 8px 10px; font-size: 0.9rem; }
            .wordlist-add { flex-direction: column; align-items: stretch; }
            .wordlist-add input { min-width: 0; }
            .wordlist-add button { min-height: 44px; }
        }
    </style>
</head>
<body>
    <div class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode"><span class="icon-light">üåô</span><span class="icon-dark">‚òÄÔ∏è</span></div>
    <div class="container">
    <nav class="nav">
        <a href="index.html">‚Üê Menu</a>
        <span>¬∑</span>
        <span><strong>1-2-3 Boxes</strong></span>
    </nav>
    <!-- <h1>1-2-3 Boxes</h1> -->
    <div class="info-box">
        <h3>
            <span class="toggle-info" onclick="toggleInfo()">üí° How to use 1-2-3 Boxes ‚ñ≤</span>
        </h3>
        <div id="infoToggle">
            <div id="infoDetail" style="display:block; margin-top:12px;">
                <p><strong>1-2-3 Boxes</strong> is a method for building conversation skills by practicing three sentence types:</p>
                <ul>
                    <li><strong>Box 1 (Statements):</strong> "I like coffee." ‚Äî State something, anything.</li>
                    <li><strong>Box 2 (Closed Questions):</strong> "Do you like coffee?" ‚Äî A yes or no question.</li>
                    <li><strong>Box 3 (Open Questions):</strong> "What do you like?" ‚Äî Use these to ask an open question. These are also your practice questions because you have to not only be able to ask them but to answer them too. Write the ones you master, or have trouble with, in a small notebook. As you practice and grow your list, you will expand what you can talk about and who you can talk to. <i><strong><u>THIS</u></strong> is what will make you <u>conversational</u> and <u>fluent</u>.</i></li>
                </ul>
                <p><strong>Usage:</strong> Pick a set (Likes, Study, Routine, etc.) ‚Üí <strong>View list</strong> to see all sentences, <strong>Practice</strong> to flip cards (Japanese front, romaji+English back), or <strong>Word lists</strong> to add/edit vocabulary.</p>
            </div>
        </div>
        <p class="deck-version" id="deckVersion" style="display: none; font-size: 0.85rem; color: var(--secondary-text); margin-top: 8px;"></p>
    </div>

    <div id="loading" class="loading">Loading boxes...</div>
    <div id="main" class="hidden">
        <div class="set-tabs" id="setTabs"></div>
        <div class="mode-tabs">
            <button type="button" class="mode-tab active" data-mode="list">View list</button>
            <button type="button" class="mode-tab" data-mode="practice">Practice (flip cards)</button>
            <button type="button" class="mode-tab" data-mode="words">Word lists</button>
            <div class="display-phase">
                <select id="romajiPhase" class="select-primary" title="Phase 1 = JA + romaji + EN, Phase 2 = JA + EN (no romaji), Phase 3 = JA only">
                    <option value="1">Phase 1 (romaji + English)</option>
                    <option value="2">Phase 2 (no romaji)</option>
                    <option value="3">Phase 3 (Japanese only)</option>
                </select>
            </div>
        </div>

        <div id="listView" class="list-view">
            <div id="listContent"></div>
        </div>
        <div id="practiceView" class="practice-area hidden">
            <div class="practice-card" id="practiceCard">
                <div class="card-inner">
                    <div class="face face-front">
                        <span class="ja" id="cardFrontJa"></span>
                        <span class="romaji" id="cardFrontRomaji"></span>
                    </div>
                    <div class="face face-back">
                        <span class="ja" id="cardBackJa"></span>
                        <span class="romaji" id="cardBackRomaji"></span>
                        <span class="en" id="cardBackEn"></span>
                    </div>
                </div>
            </div>
            <p class="card-register" id="cardRegister" style="display: none; font-size: 0.85rem; color: var(--secondary-text); margin-top: 6px;"></p>
            <div class="rating-buttons hidden" id="boxRatingButtons">
                <button class="rating-btn again" onclick="rateBoxCard(1)">
                    <span>Again</span>
                    <span class="interval" id="boxIntervalAgain">&lt;1m</span>
                </button>
                <button class="rating-btn hard" onclick="rateBoxCard(2)">
                    <span>Hard</span>
                    <span class="interval" id="boxIntervalHard">&lt;10m</span>
                </button>
                <button class="rating-btn good" onclick="rateBoxCard(3)">
                    <span>Good</span>
                    <span class="interval" id="boxIntervalGood">1d</span>
                </button>
                <button class="rating-btn easy" onclick="rateBoxCard(4)">
                    <span>Easy</span>
                    <span class="interval" id="boxIntervalEasy">4d</span>
                </button>
            </div>
            <div class="practice-controls">
                <button type="button" class="secondary" id="btnPrev">‚Üê Prev</button>
                <span class="progress-text" id="practiceProgress"></span>
                <button type="button" id="btnNext">Next ‚Üí</button>
            </div>
        </div>
        <div id="wordListView" class="wordlist-area hidden">
            <p class="subtitle" style="margin-bottom: 12px;">Add or remove words used to generate boxes. Saved in this browser only.</p>
            <div class="wordlist-cats" id="wordlistCats"></div>
            <div id="wordlistContent"></div>
            <div class="wordlist-reset">
                <button type="button" id="btnResetWords">Reset to defaults</button>
            </div>
        </div>
    </div>
    </div>
    <div id="error" class="error hidden"></div>

    <script src="tiny-segmenter.js"></script>
    <script src="romaji.js"></script>
    <script src="srs.js"></script>
    <script src="syllable-color.js"></script>
    <script src="boxes-coloring.js"></script>
    <script src="boxes-data.js"></script>
    <script>
        let config = null;
        let words = null;
        let defaultWords = null;
        let generatedItems = [];
        let currentSetId = null;
        let practiceIndex = 0;
        let practiceItems = [];
        let collapsedBoxes = {};
        let srsCards = {};
        let newCardsPerDay = 20;
        let newCardsIntroduced = 0;
        let dueCards = [];
        let isFlipped = false;

        const ROMAJI_PHASE_KEY = 'sqwease-romaji-phase';
        function getRomajiPhase() {
            var v = typeof localStorage !== 'undefined' ? localStorage.getItem(ROMAJI_PHASE_KEY) : null;
            var n = parseInt(v, 10);
            return (n === 1 || n === 2 || n === 3) ? n : 1;
        }
        function setRomajiPhase(phase) {
            if (typeof localStorage !== 'undefined') localStorage.setItem(ROMAJI_PHASE_KEY, String(phase));
        }

        /** Build tokens from ja + romaji using TinySegmenter for slot-filled items (no pre-tokenized data). */
        function buildTokensFromSegmenter(ja, romaji, en) {
            if (typeof TinySegmenter === 'undefined' || !ja || !romaji) return null;
            const segmenter = new TinySegmenter();
            let segments = segmenter.segment(ja);
            if (!segments || !segments.length) return null;
            const romajiWords = romaji.trim().split(/\s+/).filter(Boolean);
            if (!romajiWords.length) return null;
            function normalizeSegmentsForRomaji(segs) {
                function mergeDigitTime(list) {
                    const out = [];
                    for (let i = 0; i < list.length; i++) {
                        const cur = list[i];
                        const next = i + 1 < list.length ? list[i + 1] : '';
                        if (/^\d+$/.test(cur) && next === 'ÊôÇ') {
                            out.push(cur + next);
                            i++;
                            continue;
                        }
                        out.push(cur);
                    }
                    return out;
                }
                function mergeGohan(list) {
                    const out = [];
                    for (let i = 0; i < list.length; i++) {
                        const cur = list[i];
                        const next = i + 1 < list.length ? list[i + 1] : '';
                        if ((cur === '„Åî' || cur.endsWith('„Åî')) && next === '„ÅØ„Çì') {
                            out.push(cur + next);
                            i++;
                            continue;
                        }
                        out.push(cur);
                    }
                    return out;
                }
                function mergeOkonomiyaki(list) {
                    const out = [];
                    for (let i = 0; i < list.length; i++) {
                        const cur = list[i];
                        const next = i + 1 < list.length ? list[i + 1] : '';
                        if (cur === '„ÅäÂ•Ω„Åø' && next === 'ÁÑº„Åç') {
                            out.push(cur + next);
                            i++;
                            continue;
                        }
                        out.push(cur);
                    }
                    return out;
                }
                function mergeMasu(list) {
                    const out = [];
                    for (let i = 0; i < list.length; i++) {
                        const cur = list[i];
                        const next = i + 1 < list.length ? list[i + 1] : '';
                        if (next && next.startsWith('„Åæ„Åô')) {
                            out.push(cur + next);
                            i++;
                            continue;
                        }
                        out.push(cur);
                    }
                    return out;
                }
                function splitGohanCompound(list) {
                    const out = [];
                    for (let i = 0; i < list.length; i++) {
                        const seg = list[i];
                        if (seg && seg !== '„Åî„ÅØ„Çì' && seg.endsWith('„Åî„ÅØ„Çì')) {
                            const prefix = seg.slice(0, -3);
                            if (prefix) out.push(prefix);
                            out.push('„Åî„ÅØ„Çì');
                            continue;
                        }
                        out.push(seg);
                    }
                    return out;
                }
                function splitTrailingKa(list) {
                    const out = [];
                    for (let i = 0; i < list.length; i++) {
                        const seg = list[i];
                        if (!seg || seg.length <= 1) {
                            out.push(seg);
                            continue;
                        }
                        const m = seg.match(/^(.*)„Åã([„ÄÇ.!?ÔºÅÔºü])$/);
                        if (m && m[1]) {
                            out.push(m[1]);
                            out.push('„Åã' + m[2]);
                            continue;
                        }
                        if (seg.endsWith('„Åã')) {
                            out.push(seg.slice(0, -1));
                            out.push('„Åã');
                            continue;
                        }
                        out.push(seg);
                    }
                    return out;
                }
                let out = segs.slice();
                out = mergeDigitTime(out);
                out = mergeOkonomiyaki(out);
                out = mergeGohan(out);
                out = mergeMasu(out);
                out = splitGohanCompound(out);
                out = splitTrailingKa(out);
                return out;
            }
            // Merge trailing punctuation into preceding segment before count comparison
            while (segments.length > 1 && /^[„ÄÇ„ÄÅÔºÅÔºü.!?]+$/.test(segments[segments.length - 1])) {
                const punct = segments.pop();
                segments[segments.length - 1] += punct;
            }
            segments = normalizeSegmentsForRomaji(segments);
            while (segments.length > romajiWords.length && segments.length > 1) {
                const last = segments.pop();
                segments[segments.length - 1] = segments[segments.length - 1] + last;
            }
            if (segments.length !== romajiWords.length) {
                return null;
            }
            let start = 0;
            const tokens = [];
            for (let i = 0; i < segments.length; i++) {
                const seg = segments[i];
                const end = start + seg.length;
                tokens.push({
                    ja: seg,
                    kana: seg,
                    romaji: romajiWords[i],
                    en: null,
                    start: start,
                    end: end
                });
                start = end;
            }
            return tokens;
        }

        function fillTemplate(template, word) {
            let out = template;
            for (const key of Object.keys(word)) {
                out = out.replace(new RegExp('\\{' + key + '\\}', 'g'), word[key]);
            }
            return out;
        }

        function generateItems() {
            const items = [];
            const tokenized = typeof BOXES_TOKENIZED_SENTENCES !== 'undefined' ? BOXES_TOKENIZED_SENTENCES : {};
            for (const set of config.sets) {
                for (const box of set.boxes) {
                    const boxType = box.boxType != null ? box.boxType : box.boxType;
                    const boxName = box.name || '';
                    if (box.fixed) {
                        const item = {
                            ja: box.templateJa,
                            romaji: box.templateRomaji,
                            en: box.templateEn,
                            boxType: box.boxType,
                            boxType: boxType,
                            boxName: boxName,
                            setName: set.name,
                            boxName: box.name
                        };
                        const tok = tokenized[box.templateJa];
                        if (tok && tok.tokens) {
                            item.tokens = tok.tokens;
                            item.ja = tok.ja;
                            item.romaji = tok.romaji;
                            item.en = tok.en;
                            if (tok.register) item.register = tok.register;
                        }
                        items.push(item);
                    } else {
                        const slotWords = words[box.slot];
                        if (!slotWords) continue;
                        for (const w of slotWords) {
                            // #region agent log
                            fetch('http://127.0.0.1:7244/ingest/7365a28b-2540-429a-90c2-67173112e213',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'boxes.html:generateItems',message:'slot',data:{w:w,box:box},timestamp:Date.now(),hypothesisId:'H_Gen'})}).catch(function(){});
                            // #endregion
                            items.push({
                                ja: fillTemplate(box.templateJa, w),
                                romaji: fillTemplate(box.templateRomaji, w),
                                en: fillTemplate(box.templateEn, w),
                                boxType: box.boxType,
                                boxType: boxType,
                                boxName: boxName,
                                setName: set.name,
                                boxName: box.name
                            });
                        }
                    }
                }
            }
            return items;
        }

        function renderSetTabs() {
            const el = document.getElementById('setTabs');
            el.innerHTML = '';
            for (const set of config.sets) {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'set-tab' + (currentSetId === set.id ? ' active' : '');
                btn.textContent = set.name;
                btn.dataset.setId = set.id;
                btn.addEventListener('click', () => selectSet(set.id));
                el.appendChild(btn);
            }
            if (!currentSetId && config.sets.length) currentSetId = config.sets[0].id;
        }

        function selectSet(setId) {
            currentSetId = setId;
            document.querySelectorAll('.set-tab').forEach(b => {
                b.classList.toggle('active', b.dataset.setId === setId);
            });
            renderList();
            updatePracticeList();
            if (document.getElementById('practiceView').classList.contains('hidden') === false) {
                practiceIndex = 0;
                renderPracticeCard();
            }
        }

        function renderList() {
            const filtered = generatedItems.filter(i => i.setName === (config.sets.find(s => s.id === currentSetId)?.name));
            const byBox = { 1: [], 2: [], 3: [] };
            for (const item of filtered) {
                if (byBox[item.boxType]) byBox[item.boxType].push(item);
            }
            const container = document.getElementById('listContent');
            container.innerHTML = '';
            for (const boxType of [1, 2, 3]) {
                const list = byBox[boxType];
                if (!list.length) continue;
                const group = document.createElement('div');
                group.className = 'box-group';
                if (collapsedBoxes[currentSetId + '-' + boxType]) group.classList.add('collapsed');
                group.innerHTML = '<h3>Box ' + boxType + ': ' + escapeHtml(list[0].boxName) + '</h3>';
                group.querySelector('h3').addEventListener('click', (function(setId, ct, el) {
                    return function() {
                        el.classList.toggle('collapsed');
                        collapsedBoxes[setId + '-' + ct] = el.classList.contains('collapsed');
                    };
                })(currentSetId, boxType, group));
                for (const item of list) {
                    const row = document.createElement('div');
                    row.className = 'box-item';
                    const tokens = item.tokens || buildTokensFromSegmenter(item.ja, item.romaji, item.en);
                    // #region agent log
                    if (tokens) fetch('http://127.0.0.1:7244/ingest/7365a28b-2540-429a-90c2-67173112e213',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'boxes.html:renderList',message:'rendering',data:{ja:item.ja,tokens:tokens},timestamp:Date.now(),hypothesisId:'H_Render'})}).catch(function(){});
                    // #endregion
                    if (tokens && typeof BoxesColoring !== 'undefined' && BoxesColoring.colorizeBoxesItem) {
                        const isDark = typeof SyllableColor !== 'undefined' && SyllableColor.isDarkTheme ? SyllableColor.isDarkTheme() : (document.documentElement.getAttribute('data-theme') === 'dark');
                        const colored = BoxesColoring.colorizeBoxesItem(item.ja, tokens, isDark, item.en);
                        row.innerHTML = '<span class="ja">' + colored.jaHtml + '</span><span class="romaji">' + colored.romajiHtml + '</span><span class="en">' + (colored.enHtml || escapeHtml(item.en)) + '</span>';
                    } else if (tokens && typeof SyllableColor !== 'undefined' && SyllableColor.colorizeByTokens) {
                        // #region agent log
                        fetch('http://127.0.0.1:7244/ingest/7365a28b-2540-429a-90c2-67173112e213',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'boxes.html:renderList',message:'fallback',data:{path:'SyllableColor'},timestamp:Date.now(),hypothesisId:'H_Path'})}).catch(function(){});
                        // #endregion
                        const isDark = SyllableColor.isDarkTheme();
                        const colored = SyllableColor.colorizeByTokens(item.ja, tokens, isDark, item.en);
                        let enHtml = colored.enHtml;
                        if (!enHtml && SyllableColor.colorizeByWords) {
                            var coloredCount = 0;
                            if (typeof Romaji !== 'undefined' && Romaji.isParticleToken) {
                                for (var k = 0; k < tokens.length; k++) { if (!Romaji.isParticleToken(tokens[k])) coloredCount++; }
                            }
                            enHtml = SyllableColor.colorizeByWords(item.ja, item.romaji, item.en, isDark, coloredCount).enHtml;
                        }
                        row.innerHTML = '<span class="ja">' + colored.jaHtml + '</span><span class="romaji">' + colored.romajiHtml + '</span><span class="en">' + (enHtml || escapeHtml(item.en)) + '</span>';
                    } else {
                        // #region agent log
                        fetch('http://127.0.0.1:7244/ingest/7365a28b-2540-429a-90c2-67173112e213',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'boxes.html:renderList',message:'no_tokens',data:{ja:item.ja},timestamp:Date.now(),hypothesisId:'H_Path'})}).catch(function(){});
                        // #endregion
                        row.innerHTML = '<span class="ja">' + escapeHtml(item.ja) + '</span><span class="romaji">' + escapeHtml(item.romaji) + '</span><span class="en">' + escapeHtml(item.en) + '</span>';
                    }
                    var phase = getRomajiPhase();
                    var romajiSpan = row.querySelector('.romaji');
                    var enSpan = row.querySelector('.en');
                    if (romajiSpan) romajiSpan.style.display = phase >= 2 ? 'none' : '';
                    if (enSpan) enSpan.style.display = phase >= 3 ? 'none' : '';
                    group.appendChild(row);
                }
                container.appendChild(group);
            }
        }

        function escapeHtml(s) {
            const div = document.createElement('div');
            div.textContent = s;
            return div.innerHTML;
        }

        function updatePracticeList() {
            practiceItems = generatedItems.filter(i => config.sets.find(s => s.id === currentSetId) && i.setName === (config.sets.find(s => s.id === currentSetId).name));
            practiceIndex = 0;
        }

        function renderPracticeCard() {
            if (!practiceItems.length) {
                document.getElementById('cardFrontJa').textContent = 'No sentences in this set.';
                document.getElementById('cardFrontRomaji').textContent = '';
                document.getElementById('cardBackJa').textContent = '';
                document.getElementById('cardBackRomaji').textContent = '';
                document.getElementById('cardBackEn').textContent = '';
                document.getElementById('practiceProgress').textContent = '0 / 0';
                return;
            }
            const item = practiceItems[practiceIndex];
            const itemId = getItemId(item);
            const srsCard = getOrInitCard(itemId);
            
            const card = document.getElementById('practiceCard');
            card.classList.remove('flipped');
            isFlipped = false;
            document.getElementById('boxRatingButtons').classList.add('hidden');
            
            const cardTokens = item.tokens || buildTokensFromSegmenter(item.ja, item.romaji, item.en);
            // #region agent log
            if (cardTokens) fetch('http://127.0.0.1:7244/ingest/7365a28b-2540-429a-90c2-67173112e213',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'boxes.html:renderPracticeCard',message:'rendering',data:{ja:item.ja,tokens:cardTokens},timestamp:Date.now(),hypothesisId:'H_Render'})}).catch(function(){});
            // #endregion
            if (cardTokens && typeof BoxesColoring !== 'undefined' && BoxesColoring.colorizeBoxesItem) {
                var isDark = typeof SyllableColor !== 'undefined' && SyllableColor.isDarkTheme ? SyllableColor.isDarkTheme() : (document.documentElement.getAttribute('data-theme') === 'dark');
                var colored = BoxesColoring.colorizeBoxesItem(item.ja, cardTokens, isDark, item.en);
                document.getElementById('cardFrontJa').innerHTML = colored.jaHtml;
                document.getElementById('cardFrontRomaji').innerHTML = colored.romajiHtml;
                document.getElementById('cardBackJa').innerHTML = colored.jaHtml;
                document.getElementById('cardBackRomaji').innerHTML = colored.romajiHtml;
                document.getElementById('cardBackEn').innerHTML = colored.enHtml || escapeHtml(item.en);
            } else if (cardTokens && typeof SyllableColor !== 'undefined' && SyllableColor.colorizeByTokens) {
                var isDark = SyllableColor.isDarkTheme();
                var colored = SyllableColor.colorizeByTokens(item.ja, cardTokens, isDark, item.en);
                document.getElementById('cardFrontJa').innerHTML = colored.jaHtml;
                document.getElementById('cardFrontRomaji').innerHTML = colored.romajiHtml;
                document.getElementById('cardBackJa').innerHTML = colored.jaHtml;
                document.getElementById('cardBackRomaji').innerHTML = colored.romajiHtml;
                var enHtml = colored.enHtml;
                if (!enHtml && SyllableColor.colorizeByWords) {
                    var coloredCount = 0;
                    if (typeof Romaji !== 'undefined' && Romaji.isParticleToken) {
                        for (var k = 0; k < cardTokens.length; k++) { if (!Romaji.isParticleToken(cardTokens[k])) coloredCount++; }
                    }
                    enHtml = SyllableColor.colorizeByWords(item.ja, item.romaji, item.en, isDark, coloredCount).enHtml;
                }
                document.getElementById('cardBackEn').innerHTML = enHtml || escapeHtml(item.en);
            } else if (typeof SyllableColor !== 'undefined' && SyllableColor.colorizeByWords) {
                var isDark = SyllableColor.isDarkTheme();
                var colored = SyllableColor.colorizeByWords(item.ja, item.romaji, item.en, isDark);
                document.getElementById('cardFrontJa').innerHTML = colored.jaHtml;
                document.getElementById('cardFrontRomaji').innerHTML = colored.romajiHtml;
                document.getElementById('cardBackJa').innerHTML = colored.jaHtml;
                document.getElementById('cardBackRomaji').innerHTML = colored.romajiHtml;
                document.getElementById('cardBackEn').innerHTML = colored.enHtml;
            } else {
                document.getElementById('cardFrontJa').textContent = item.ja;
                document.getElementById('cardFrontRomaji').textContent = item.romaji;
                document.getElementById('cardBackJa').textContent = item.ja;
                document.getElementById('cardBackRomaji').textContent = item.romaji;
                document.getElementById('cardBackEn').textContent = item.en;
            }
            var phase = getRomajiPhase();
            document.getElementById('cardFrontRomaji').style.display = phase >= 2 ? 'none' : '';
            document.getElementById('cardBackRomaji').style.display = phase >= 2 ? 'none' : '';
            document.getElementById('cardBackEn').style.display = phase >= 3 ? 'none' : '';
            document.getElementById('practiceProgress').textContent = (practiceIndex + 1) + ' / ' + practiceItems.length;
            var cardRegisterEl = document.getElementById('cardRegister');
            if (cardRegisterEl) {
                cardRegisterEl.textContent = item.register ? ('Register: ' + item.register) : '';
                cardRegisterEl.style.display = item.register ? 'block' : 'none';
            }
            document.getElementById('boxIntervalAgain').textContent = SRS.getIntervalDisplay(srsCard, 1);
            document.getElementById('boxIntervalHard').textContent = SRS.getIntervalDisplay(srsCard, 2);
            document.getElementById('boxIntervalGood').textContent = SRS.getIntervalDisplay(srsCard, 3);
            document.getElementById('boxIntervalEasy').textContent = SRS.getIntervalDisplay(srsCard, 4);
        }
        
        function rateBoxCard(rating) {
            if (!practiceItems.length) return;
            const item = practiceItems[practiceIndex];
            const itemId = getItemId(item);
            const srsCard = getOrInitCard(itemId);
            
            const updated = SRS.reviewCard(srsCard, rating);
            srsCards[itemId] = updated;
            saveSRSBoxes();
            
            if (practiceIndex < practiceItems.length - 1) {
                practiceIndex++;
                renderPracticeCard();
            }
        }

        function initPractice() {
            updatePracticeList();
            practiceIndex = 0;
            renderPracticeCard();
            document.getElementById('practiceCard').addEventListener('click', () => {
                const card = document.getElementById('practiceCard');
                card.classList.toggle('flipped');
                isFlipped = !isFlipped;
                if (isFlipped) {
                    document.getElementById('boxRatingButtons').classList.remove('hidden');
                } else {
                    document.getElementById('boxRatingButtons').classList.add('hidden');
                }
            });
            document.getElementById('btnPrev').addEventListener('click', () => {
                if (practiceIndex > 0) {
                    practiceIndex--;
                    renderPracticeCard();
                }
            });
            document.getElementById('btnNext').addEventListener('click', () => {
                if (practiceIndex < practiceItems.length - 1) {
                    practiceIndex++;
                    renderPracticeCard();
                }
            });
            document.addEventListener('keydown', (e) => {
                if (document.getElementById('practiceView').classList.contains('hidden')) return;
                if (e.code === 'Space' || e.code === 'ArrowUp' || e.code === 'ArrowDown') {
                    e.preventDefault();
                    const card = document.getElementById('practiceCard');
                    card.classList.toggle('flipped');
                    isFlipped = !isFlipped;
                    if (isFlipped) {
                        document.getElementById('boxRatingButtons').classList.remove('hidden');
                    } else {
                        document.getElementById('boxRatingButtons').classList.add('hidden');
                    }
                } else if (isFlipped) {
                    if (e.code === 'Digit1') rateBoxCard(1);
                    else if (e.code === 'Digit2') rateBoxCard(2);
                    else if (e.code === 'Digit3') rateBoxCard(3);
                    else if (e.code === 'Digit4') rateBoxCard(4);
                } else if (e.code === 'ArrowRight') {
                    if (practiceIndex < practiceItems.length - 1) {
                        practiceIndex++;
                        renderPracticeCard();
                    }
                } else if (e.code === 'ArrowLeft') {
                    if (practiceIndex > 0) {
                        practiceIndex--;
                        renderPracticeCard();
                    }
                }
            });
        }

        const WORDLIST_CATEGORIES = [
            { key: 'nounsLikes', label: 'Nouns (likes)', fields: ['j', 'r', 'e'] },
            { key: 'nounsStudy', label: 'Study subjects', fields: ['j', 'r', 'e'] },
            { key: 'jobs', label: 'Jobs', fields: ['j', 'r', 'e'] },
            { key: 'places', label: 'Places', fields: ['j', 'r', 'e'] },
            { key: 'verbsWant', label: 'Verbs (want)', fields: ['j', 'r', 'e', 'tai', 'tsumori'] },
            { key: 'verbsRoutine', label: 'Verbs (routine)', fields: ['j', 'r', 'e', 'masu', 'mashita'] },
            { key: 'routinePairs', label: 'Routine (time + verb)', fields: ['timeJ', 'timeR', 'timeE', 'verbMasu', 'verbR', 'verbE'] }
        ];
        const WORDLIST_FIELD_LABELS = { j: 'Japanese', r: 'Romaji', e: 'English', tai: '„Äú„Åü„ÅÑ', tsumori: '„Å§„ÇÇ„Çä', masu: '„Åæ„ÅôÂΩ¢', mashita: '„Åæ„Åó„Åü', timeJ: 'Time (ja)', timeR: 'Time (romaji)', timeE: 'Time (en)', verbMasu: 'Verb „Åæ„Åô', verbR: 'Verb (romaji)', verbE: 'Verb (en)' };
        let currentWordlistCat = 'nounsLikes';

        function saveSRSBoxes() {
            localStorage.setItem('sqwease-boxes-srs', JSON.stringify(srsCards));
            const today = new Date().toDateString();
            localStorage.setItem('sqwease-boxes-date', today);
            localStorage.setItem('sqwease-boxes-new-today', newCardsIntroduced.toString());
        }

        function loadSRSBoxes() {
            const stored = localStorage.getItem('sqwease-boxes-srs');
            if (stored) {
                srsCards = JSON.parse(stored);
            }
            const storedDate = localStorage.getItem('sqwease-boxes-date');
            const today = new Date().toDateString();
            if (storedDate === today) {
                newCardsIntroduced = parseInt(localStorage.getItem('sqwease-boxes-new-today') || '0');
            } else {
                newCardsIntroduced = 0;
            }
        }

        function getOrInitCard(itemId) {
            if (!srsCards[itemId]) {
                srsCards[itemId] = SRS.initCard(itemId);
            }
            return srsCards[itemId];
        }

        function getItemId(item) {
            return 'box-' + item.ja + '-' + item.en;
        }

        function saveWords() {
            try {
                localStorage.setItem('sqwease-boxes-words', JSON.stringify(words));
            } catch (err) {}
            generatedItems = generateItems();
            renderList();
            updatePracticeList();
            renderPracticeCard();
        }

        function removeWord(slot, index) {
            if (!words[slot] || index < 0 || index >= words[slot].length) return;
            words[slot].splice(index, 1);
            saveWords();
            renderWordListContent();
        }

        function addWord(slot, entry) {
            if (!words[slot]) words[slot] = [];
            words[slot].push(entry);
            saveWords();
            renderWordListContent();
        }

        function renderWordListCats() {
            const el = document.getElementById('wordlistCats');
            el.innerHTML = '';
            WORDLIST_CATEGORIES.forEach(cat => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'wordlist-cat' + (currentWordlistCat === cat.key ? ' active' : '');
                btn.textContent = cat.label;
                btn.dataset.cat = cat.key;
                btn.addEventListener('click', () => {
                    currentWordlistCat = cat.key;
                    document.querySelectorAll('.wordlist-cat').forEach(b => b.classList.toggle('active', b.dataset.cat === cat.key));
                    renderWordListContent();
                });
                el.appendChild(btn);
            });
        }

        function renderWordListContent() {
            const cat = WORDLIST_CATEGORIES.find(c => c.key === currentWordlistCat);
            const container = document.getElementById('wordlistContent');
            container.innerHTML = '';
            if (!cat || !words[cat.key]) return;
            const list = words[cat.key];
            const table = document.createElement('table');
            table.className = 'wordlist-table';
            const thead = document.createElement('thead');
            const headers = cat.fields.map(f => WORDLIST_FIELD_LABELS[f] || f);
            thead.innerHTML = '<tr><th>' + headers.join('</th><th>') + '</th><th></th></tr>';
            table.appendChild(thead);
            const tbody = document.createElement('tbody');
            list.forEach((row, i) => {
                const tr = document.createElement('tr');
                const cells = cat.fields.map(f => escapeHtml(row[f] || '')).join('</td><td>');
                tr.innerHTML = '<td>' + cells + '</td><td><button type="button" class="remove-btn" data-index="' + i + '">Remove</button></td>';
                tr.querySelector('.remove-btn').addEventListener('click', () => removeWord(cat.key, i));
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            container.appendChild(table);
            const addDiv = document.createElement('div');
            addDiv.className = 'wordlist-add';
            const fields = cat.fields.map(f => {
                const wrap = document.createElement('div');
                wrap.className = 'field';
                wrap.innerHTML = '<label>' + (WORDLIST_FIELD_LABELS[f] || f) + '</label><input type="text" data-field="' + f + '" placeholder="">';
                return wrap;
            });
            fields.forEach(f => addDiv.appendChild(f));
            const addBtn = document.createElement('button');
            addBtn.type = 'button';
            addBtn.textContent = 'Add';
            addBtn.addEventListener('click', () => {
                const entry = {};
                cat.fields.forEach(f => {
                    const val = addDiv.querySelector('input[data-field="' + f + '"]').value.trim();
                    if (val) entry[f] = val;
                });
                if (Object.keys(entry).length < 2) return;
                addWord(cat.key, entry);
                cat.fields.forEach(f => { addDiv.querySelector('input[data-field="' + f + '"]').value = ''; });
            });
            addDiv.appendChild(addBtn);
            container.appendChild(addDiv);
        }

        document.querySelectorAll('.mode-tab').forEach(btn => {
            btn.addEventListener('click', () => {
                const mode = btn.dataset.mode;
                document.querySelectorAll('.mode-tab').forEach(b => b.classList.toggle('active', b.dataset.mode === mode));
                document.getElementById('listView').classList.toggle('hidden', mode !== 'list');
                document.getElementById('practiceView').classList.toggle('hidden', mode !== 'practice');
                document.getElementById('wordListView').classList.toggle('hidden', mode !== 'words');
                if (mode === 'practice') {
                    updatePracticeList();
                    renderPracticeCard();
                }
                if (mode === 'words') {
                    renderWordListCats();
                    renderWordListContent();
                }
            });
        });

        document.getElementById('btnResetWords').addEventListener('click', () => {
            if (!confirm('Reset all word lists to defaults? Your added words will be removed.')) return;
            if (!defaultWords) return;
            words = JSON.parse(JSON.stringify(defaultWords));
            saveWords();
            renderWordListCats();
            renderWordListContent();
        });

        function load() {
            try {
                if (typeof BOXES_CONFIG === 'undefined' || typeof BOXES_WORDS === 'undefined') {
                    throw new Error('boxes-data.js not loaded');
                }
                config = BOXES_CONFIG;
                defaultWords = BOXES_WORDS;
                // Normalize: config/source may use "boxes"; runtime expects "boxes" and boxType
                config.sets.forEach(function(s) {
                    if (!s.boxes && s.boxes) s.boxes = s.boxes;
                    if (s.boxes) s.boxes.forEach(function(b) {
                        if (b.boxType === undefined && b.boxType !== undefined) b.boxType = b.boxType;
                    });
                });
                const stored = localStorage.getItem('sqwease-boxes-words');
                words = stored ? JSON.parse(stored) : JSON.parse(JSON.stringify(defaultWords));
                if (!words.nounsLikes || !Array.isArray(words.nounsLikes)) words = JSON.parse(JSON.stringify(defaultWords));
                generatedItems = generateItems();
                currentSetId = config.sets[0]?.id || null;
                loadSRSBoxes();
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('main').classList.remove('hidden');
                var versionEl = document.getElementById('deckVersion');
                if (versionEl && typeof BOXES_TOKENIZED_VERSION !== 'undefined' && BOXES_TOKENIZED_VERSION != null) {
                    versionEl.textContent = 'Tokenized deck v' + String(BOXES_TOKENIZED_VERSION);
                    versionEl.style.display = 'block';
                }
                renderSetTabs();
                renderList();
                initPractice();
                var phaseEl = document.getElementById('romajiPhase');
                if (phaseEl) {
                    phaseEl.value = String(getRomajiPhase());
                    phaseEl.addEventListener('change', function() {
                        setRomajiPhase(parseInt(phaseEl.value, 10));
                        renderList();
                        if (!document.getElementById('practiceView').classList.contains('hidden')) renderPracticeCard();
                    });
                }
            } catch (e) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error').textContent = 'Could not load boxes data. Run: node scripts/build-boxes-data.js then open boxes.html (or ensure boxes-data.js is in the same folder as boxes.html).';
            }
        }
        load();
        
        function toggleInfo() {
            const detail = document.getElementById('infoDetail');
            const toggle = document.querySelector('.toggle-info');
            if (detail.style.display === 'none') {
                detail.style.display = 'block';
                toggle.textContent = 'üí° How to use 1-2-3 Boxes ‚ñ≤';
            } else {
                detail.style.display = 'none';
                toggle.textContent = 'üí° How to use 1-2-3 Boxes ‚ñº';
            }
        }
        
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('sqwease-theme', next);
        }
        const saved = localStorage.getItem('sqwease-theme');
        if (saved) document.documentElement.setAttribute('data-theme', saved);
    </script>
</body>
</html>
